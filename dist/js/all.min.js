function initApplication(){var t=io.connect(""),e=new Timeline,i=new TimelineLite({align:"sequence"}),a=$("#applicationPro-username"),n=$("#applicationPro-status"),s=$("#applicationPro-starttime"),o=$("#applicationPro-endtime"),r=$(".progress-bar div");return t.on("connect",function(){t.emit("join",{appid:Util.getUrlParam("appid")})}),t.on("appinfo",function(t){console.log("appinfo:",t),$.each(t.data,function(t,e){""!==e&&null!==e&&void 0!==e&&(APPLICATION.info[t]=e)}),(void 0===t.data.endtime||void 0===APPLICATION.info.endtime||""===APPLICATION.info.endtime)&&(APPLICATION.info.endtime=Util.DateOperate("m",APPLICATION.Estimate,new Date(APPLICATION.info.starttime))),APPLICATION.info.starttime=Util.toAppDateString(new Date(APPLICATION.info.starttime)),APPLICATION.info.endtime=Util.toAppDateString(new Date(APPLICATION.info.endtime)),a.text(APPLICATION.info.username),s.html(APPLICATION.info.starttime.split(" ")[0]+" <time>"+APPLICATION.info.starttime.split(" ")[1]+"</time>"),o.html(APPLICATION.info.endtime.split(" ")[0]+" <time>"+APPLICATION.info.endtime.split(" ")[1]+"</time>")}),t.on("status",function(t){console.log("status:",t);var e=new Date(APPLICATION.info.starttime),a=new Date(t.timestamp),s=new Date(APPLICATION.info.endtime),o=a-e,l=APPLICATION.Status.done.indexOf(t.data.key)>=0?!0:!1,c=l?100:o/(s-e)*100;c=c>100?100:c,i.add(function(){r.css({width:c+"%"}).attr({"class":"progress-status-"+t.data.key}),n.text(t.data.value)},"+=0.1")}),t.on("timeline",function(t){console.log("timeline:",t),t.forEach(function(t){i.add(function(){e.addItem(t)},"+=1.2")})}),t}!function(t){t.Timeline=function(){this.init()};var e=t.Timeline.prototype;e.init=function(){this.$=$(".timeline .timeline-list"),this.initPlugins()},e.initPlugins=function(){Highcharts.getOptions().colors=Highcharts.map(Highcharts.getOptions().colors,function(t){return{radialGradient:{cx:.5,cy:.3,r:.7},stops:[[0,t],[1,Highcharts.Color(t).brighten(-.3).get("rgb")]]}});var t=Highcharts.getOptions().colors[0];Highcharts.getOptions().colors[0]=Highcharts.getOptions().colors[2],Highcharts.getOptions().colors[2]=t},e.addItem=function(t){var e=new i(t);this.$.prepend(e.$),e.show()};var i=function(t){this.json=t||{},this.init(t)},a=i.prototype;a.init=function(t){this.createTemplate(t)},a.show=function(){var t=this.$icon,e=this.$time,i=this.$cont,a=this;$(window).scrollTop(0),TweenLite.set(t,{css:{y:"-50%",alpha:0}}),TweenLite.to(e,.2,{css:{alpha:1}}),TweenLite.to(t,.6,{css:{y:"0%",alpha:1},onComplete:function(){a.$.addClass("role_"+a.json.role+"__animate")}}),TweenLite.to(i,.25,{delay:.8,css:{scale:1,alpha:1}})},a.createTemplate=function(t){var e=t.role||"machine",i=t.type||"table",a=Util.toAppDateString(new Date(t.timestamp)),n=a.split(" ")[0],s=a.split(" ")[1],o="user"==e?APPLICATION.info.wxheadurl:"assets/images/icon-"+e+".png";this.$=$('<div class="timeline-item"><div class="timeline-content"><div class="content-body clearfix"></div></div></div>'),this.$icon=$('<div class="timeline-icon"><div class="icon-bubble"></div><div class="icon-mask"></div><img class="icon-pic" src="'+o+'"></div>'),this.$time=$('<div class="timeline-time"><i class="fa fa-clock-o"></i><span>'+n+"</span><time>"+s+"</time></div>"),this.$.append(this.$icon).append(this.$time),this.$.addClass("role_"+e),this.$cont=this.$.find(".content-body"),this["create$"+i](t)},a.create$picture=function(t){var e=t.data.url,i=t.data.title;this.$picture=$('<div class="picture"><img src="'+e+'"><h2>'+i+"</h2></div>"),this.$cont.prepend(this.$picture),this.$picture.find("img").on("load",function(){var t=$(this);t.width()>t.height()&&t.parent(".picture").addClass("picture_h")})},a.create$map=function(t){var e=t.data.address,i=t.data.title;this.$map=$('<div class="map"></div>'),this.$cont.prepend(this.$map);var a=new BMap.Map(this.$map[0]),n=new BMap.Point(121.53927,31.224103);a.centerAndZoom(n,12),a.addControl(new BMap.NavigationControl({type:BMAP_NAVIGATION_CONTROL_SMALL})),a.addControl(new BMap.OverviewMapControl({size:new BMap.Size(100,100),anchor:BMAP_ANCHOR_BOTTOM_RIGHT})),a.enableAutoResize();var s=new BMap.Geocoder;s.getPoint(e,function(t){if(t){a.centerAndZoom(t,14);var n=new BMap.Marker(t);a.addOverlay(n);var s=new BMap.Label("<h2>"+i+'</h2><address style="font-size:14px">'+e+"</address>");s.setStyle({fontSize:"16px",borderRadius:"3px",backgroundColor:"rgba(255,255,255,0.8)",border:"none",boxShadow:"0 0 5px 2px rgba(255,0,0,0.5) ",transform:"translate(-50%,-105%)"}),n.setLabel(s)}else console.log("您选择地址没有解析到结果!")})},a.create$table=function(t){var e=t.data.title,i=t.data.results,a="";this.$table=$('<div class="table"></div>').append("<h2>"+e+"</h2>");for(var n=0,s=i.length,o=null;s>n;n++)o=i[n],a+='<tr class="status-'+o.status+'"><td class="key">'+o.key+'</td><td class="value">'+o.value+"</td></tr>";$("<table></table>").append(a).appendTo(this.$table),this.$cont.append(this.$table)},a.create$checklist=function(t){var e=t.data.title,i=t.data.results,a="",n={"-1":"fa-question-circle",0:"fa-check-circle",1:"fa-exclamation-circle",2:"fa-times-circle"};this.$checklist=$('<div class="checklist"></div>').append("<h2>"+e+"</h2>");for(var s=0,o=i.length,r=null;o>s;s++)r=i[s],a+='<tr><td class="status"><i class="fa '+n[r.status]+'"></i></td><td class="cont">'+r.key+"</td></tr>";$("<table></table>").append(a).appendTo(this.$checklist),this.$cont.prepend(this.$checklist)},a.create$piechart=function(t){for(var e=t.data.title,i=t.data.results,a=0,n=0,s=i.length;s>n;n++)a+=i[n].y;this.$chart=$('<div class="piechart"></div>'),this.$cont.append(this.$chart);var o={chart:{backgroundColor:"transparent",width:400,height:300},title:{text:e+"(至今提交<b>"+a+"</b>单)"},tooltip:{pointFormat:"{series.name}: <b>{point.y}单</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.2f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:e,data:i}]};this.$chart.highcharts(o)},t.APPLICATION={Status:{"-1":"申请已取消",0:"开始申请",10:"申请已提交",23:"预批准",29:"所有文件已上传",30:"正式批准",35:"商户批准",40:"已拒绝",100:"还款中",200:"已逾期",500:"分期已结束",600:"提前还款",done:["-1","40","100","200","500","600"]},Estimate:30,info:{username:"买单侠",wxheadurl:"assets/images/icon-default.png",starttime:"",endtime:""},currentstatus:0,timeline_messages:[]}}(window,document,void 0),$(function(){$('<button  style="position:fixed; right:10px;top:70px;z-index:100; background:#fff;">emit appinfo</button>').prependTo("body").on("click",function(){var e=new Date,i={timestamp:Util.toAppDateString(e),data:{username:"张三",wxheadurl:"assets/images/icon-user.png",starttime:Util.toAppDateString(Util.DateOperate("m",-15,e)),endtime:Util.toAppDateString(Util.DateOperate("m",30,e))}};t.emit("appinfo",i)}),$('<button  style="position:fixed; right:10px;top:100px;z-index:130; background:#fff;">emit status</button>').prependTo("body").on("click",function(){var e=new Date,i=["-1","0","10","23","29","30","35","40","100","200","500","600"],a=i[parseInt(i.length*Math.random())],n={timestamp:Util.toAppDateString(e),data:{key:a,value:APPLICATION.Status[a]}};t.emit("status",n)}),$('<button  style="position:fixed; right:10px;top:130px;z-index:100; background:#fff;">emit timeline</button>').prependTo("body").on("click",function(){var e=["table","checklist","map","picture","piechart"],i=["user","machine","artificial"],a={picture:{timestamp:"2014-04-03 15:32:33",type:"picture",role:"user",data:{title:"张三 身份证照片",url:"assets/images/pic-2.png"}},map:{timestamp:"2014-04-03 15:32:33",type:"map",role:"machine",data:{title:"张三 现住址",address:"南通市崇川区杨舍镇上进路69号6室"}},table:{timestamp:"2015-03-30 15:32:33",type:"table",role:"user",data:{title:"用户扫码（微信申请信息）",results:[{key:"微信用户名",value:"海贼王一样的男人",status:-1},{key:"身份信息",value:"男，28岁",status:0},{key:"常住地址",value:"京都一号",status:-1}]}},checklist:{timestamp:"2015-03-30 15:32:33",type:"checklist",role:"user",data:{title:"审核信息",results:[{key:"个人信息审核",status:0},{key:"银行卡审核",status:1},{key:"捷信和被执行审核",status:1},{key:"客户电话审核",status:0}]}},piechart:{timestamp:"2015-03-30 15:32:33",type:"piechart",role:"machine",data:{title:"秦淮八艳",results:[{name:"成功",y:30},{name:"拒绝",y:30},{name:"逾期",y:30}]}}},n=e[parseInt(e.length*Math.random())],s=i[parseInt(i.length*Math.random())],o=$.extend({},a[n],{role:s});t.emit("timeline",[o])}),io=function(){},io.connect=function(){var t=function(){this.listener={}};return t.prototype={on:function(t,e){this.listener[t]=e},emit:function(t,e){this.listener[t](e)}},new t};var t=initApplication()});